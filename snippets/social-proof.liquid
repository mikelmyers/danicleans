{% comment %}
  Social Proof Notification Popups
  Shows rotating "recent activity" toasts like:
  "Sarah from Crozet just booked a cleaning..."
  Creates urgency and trust. Shown on every page.
{% endcomment %}

<div class="proof-toast" id="proofToast" style="display:none;">
  <div class="proof-toast-icon">&#10003;</div>
  <div class="proof-toast-text">
    <strong id="proofName">Someone</strong>
    <span id="proofAction">just requested an estimate</span>
    <span class="proof-time" id="proofTime">2 hours ago</span>
  </div>
  <button class="proof-toast-dismiss" id="proofDismiss" aria-label="Dismiss">&times;</button>
</div>

<style>
.proof-toast {
  position: fixed;
  bottom: 20px;
  left: 20px;
  z-index: 997;
  background: #fff;
  border: 1px solid #e0e8e0;
  border-radius: 10px;
  padding: 14px 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.1);
  max-width: 340px;
  animation: proofSlideIn 0.4s ease;
  font-size: 14px;
}
@keyframes proofSlideIn { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.proof-toast-icon {
  width: 32px; height: 32px; background: #2d6a4f; color: #fff;
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  font-size: 16px; flex-shrink: 0;
}
.proof-toast-text { line-height: 1.3; }
.proof-toast-text strong { display: block; color: #1a3a2a; }
.proof-toast-text span { color: #555; font-size: 13px; }
.proof-time { display: block; font-size: 12px !important; color: #999 !important; }
.proof-toast-dismiss {
  background: none; border: none; font-size: 18px; cursor: pointer;
  color: #ccc; padding: 2px 4px; flex-shrink: 0;
}
.proof-toast-dismiss:hover { color: #666; }

@media (max-width: 749px) {
  .proof-toast { bottom: 88px; left: 10px; right: 10px; max-width: none; }
}
</style>

<script>
(function() {
  var MAX_TOASTS_PER_SESSION = 3;
  var INTERVAL_MS = 90000; // 90 seconds between toasts
  var FIRST_DELAY_MS = 30000; // 30 seconds before first toast

  // Check how many toasts have already been shown this session
  var toastsShown = 0;
  try { toastsShown = parseInt(sessionStorage.getItem('dc_proof_count') || '0'); } catch(e) {}
  if (toastsShown >= MAX_TOASTS_PER_SESSION) return;

  var PROOFS = [
    { name: "Sarah from Crozet", action: "booked a recurring cleaning" },
    { name: "James from Charlottesville", action: "requested a deep cleaning estimate" },
    { name: "Maria from Albemarle", action: "signed up for lawn care" },
    { name: "David from Keswick", action: "booked a move-out cleaning" },
    { name: "Rachel from Earlysville", action: "requested a landscaping quote" },
    { name: "Mike from Waynesboro", action: "booked cleaning + landscaping bundle" },
    { name: "Emily from Staunton", action: "signed up for bi-weekly cleaning" },
    { name: "Tom from Free Union", action: "requested a seasonal cleanup estimate" },
    { name: "Lisa from Lake Monticello", action: "booked a deep cleaning" },
    { name: "Chris from Gordonsville", action: "signed up for weekly lawn care" }
  ];

  var TIMES = ["12 minutes ago", "34 minutes ago", "1 hour ago", "2 hours ago", "3 hours ago", "5 hours ago", "earlier today", "yesterday"];

  var toast = document.getElementById('proofToast');
  var dismissed = false;
  var currentIndex = Math.floor(Math.random() * PROOFS.length);

  document.getElementById('proofDismiss').addEventListener('click', function() {
    toast.style.display = 'none';
    dismissed = true;
  });

  function showProof() {
    if (dismissed) return;
    try { toastsShown = parseInt(sessionStorage.getItem('dc_proof_count') || '0'); } catch(e) {}
    if (toastsShown >= MAX_TOASTS_PER_SESSION) return;

    var proof = PROOFS[currentIndex % PROOFS.length];
    var time = TIMES[Math.floor(Math.random() * TIMES.length)];

    document.getElementById('proofName').textContent = proof.name;
    document.getElementById('proofAction').textContent = proof.action;
    document.getElementById('proofTime').textContent = time;
    toast.style.display = 'flex';
    toast.style.animation = 'none';
    toast.offsetHeight;
    toast.style.animation = 'proofSlideIn 0.4s ease';

    currentIndex++;
    toastsShown++;
    try { sessionStorage.setItem('dc_proof_count', toastsShown.toString()); } catch(e) {}

    setTimeout(function() {
      if (!dismissed) toast.style.display = 'none';
    }, 6000);
  }

  // Show first proof after 30 seconds, then every 90 seconds (max 3 per session)
  setTimeout(function() {
    showProof();
    var interval = setInterval(function() {
      try { toastsShown = parseInt(sessionStorage.getItem('dc_proof_count') || '0'); } catch(e) {}
      if (toastsShown >= MAX_TOASTS_PER_SESSION) { clearInterval(interval); return; }
      showProof();
    }, INTERVAL_MS);
  }, FIRST_DELAY_MS);
})();
</script>
