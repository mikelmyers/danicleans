{% comment %}
  Animated Stats Counter Section
  Shows business metrics that build instant credibility.
  Numbers animate when scrolled into view.
{% endcomment %}

<section class="stats-section" style="padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;">
  <div class="stats-container">
    {% if section.settings.heading != blank %}
      <h2 class="stats-heading">{{ section.settings.heading }}</h2>
    {% endif %}
    <div class="stats-grid">
      {% for block in section.blocks %}
        <div class="stats-item" {{ block.shopify_attributes }}>
          <div class="stats-number" data-target="{{ block.settings.number }}">0</div>
          <div class="stats-suffix">{{ block.settings.suffix }}</div>
          <div class="stats-label">{{ block.settings.label }}</div>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<style>
.stats-section { background: linear-gradient(135deg, #1a3a2a 0%, #2d6a4f 100%); color: #fff; }
.stats-container { max-width: 1000px; margin: 0 auto; padding: 0 20px; }
.stats-heading { text-align: center; font-size: 28px; margin-bottom: 40px; opacity: 0.95; }
.stats-grid {
  display: grid;
  grid-template-columns: repeat({{ section.blocks.size }}, 1fr);
  gap: 24px;
  text-align: center;
}
.stats-item { padding: 20px 10px; }
.stats-number {
  font-size: 48px; font-weight: 800; line-height: 1;
  margin-bottom: 4px;
  display: inline;
}
.stats-suffix {
  display: inline;
  font-size: 36px;
  font-weight: 700;
  opacity: 0.9;
}
.stats-label {
  font-size: 15px; opacity: 0.8; margin-top: 8px; font-weight: 500;
}
@media (max-width: 600px) {
  .stats-grid { grid-template-columns: 1fr 1fr; }
  .stats-number { font-size: 36px; }
  .stats-suffix { font-size: 28px; }
}
</style>

<script>
(function() {
  var animated = false;
  var counters = document.querySelectorAll('.stats-number');
  if (!counters.length) return;

  function animateCounters() {
    if (animated) return;
    animated = true;
    counters.forEach(function(el) {
      var target = parseInt(el.getAttribute('data-target')) || 0;
      var duration = 2000;
      var start = 0;
      var startTime = null;

      function step(timestamp) {
        if (!startTime) startTime = timestamp;
        var progress = Math.min((timestamp - startTime) / duration, 1);
        var eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
        var current = Math.floor(eased * target);
        el.textContent = current.toLocaleString();
        if (progress < 1) requestAnimationFrame(step);
        else el.textContent = target.toLocaleString();
      }
      requestAnimationFrame(step);
    });
  }

  // Trigger when scrolled into view
  if ('IntersectionObserver' in window) {
    var observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          animateCounters();
          observer.disconnect();
        }
      });
    }, { threshold: 0.3 });
    observer.observe(document.querySelector('.stats-section'));
  } else {
    animateCounters();
  }
})();
</script>

{% schema %}
{
  "name": "Stats Counter",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Trusted Across Central Virginia"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0, "max": 100, "step": 4, "unit": "px",
      "label": "Top padding", "default": 52
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0, "max": 100, "step": 4, "unit": "px",
      "label": "Bottom padding", "default": 52
    }
  ],
  "blocks": [
    {
      "type": "stat",
      "name": "Stat",
      "settings": [
        {
          "type": "text",
          "id": "number",
          "label": "Number",
          "default": "500"
        },
        {
          "type": "text",
          "id": "suffix",
          "label": "Suffix (e.g. +, %, K)",
          "default": "+"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Homes Cleaned"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Stats Counter",
      "blocks": [
        { "type": "stat", "settings": { "number": "500", "suffix": "+", "label": "Homes Serviced" } },
        { "type": "stat", "settings": { "number": "5", "suffix": "â˜…", "label": "Average Rating" } },
        { "type": "stat", "settings": { "number": "8", "suffix": "+", "label": "Years Experience" } },
        { "type": "stat", "settings": { "number": "98", "suffix": "%", "label": "Repeat Customers" } }
      ]
    }
  ]
}
{% endschema %}
