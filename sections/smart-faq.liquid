{% comment %}
  Smart FAQ Section with Search
  Answers common questions instantly, reducing support calls.
  Also outputs FAQ Schema markup for Google rich results.
{% endcomment %}

<div class="smart-faq-section" style="padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;">
  <div class="smart-faq-container">
    <h2 class="smart-faq-title">{{ section.settings.heading }}</h2>

    <div class="faq-search-wrap">
      <input type="text" id="faqSearch" class="faq-search-input" placeholder="Search for answers..." autocomplete="off">
      <span class="faq-search-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      </span>
    </div>

    <div class="faq-no-results" id="faqNoResults" style="display:none;">
      No matching questions found. <a href="/pages/request-a-quote">Contact us</a> and we'll help!
    </div>

    <div class="faq-list" id="faqList">
      {% for block in section.blocks %}
        <div class="faq-item" data-question="{{ block.settings.question | downcase }}" data-answer="{{ block.settings.answer | strip_html | downcase }}">
          <button class="faq-question" aria-expanded="false">
            <span>{{ block.settings.question }}</span>
            <svg class="faq-chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </button>
          <div class="faq-answer">
            {{ block.settings.answer }}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- FAQ Schema Markup for SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for block in section.blocks %}
    {
      "@type": "Question",
      "name": {{ block.settings.question | json }},
      "acceptedAnswer": {
        "@type": "Answer",
        "text": {{ block.settings.answer | strip_html | json }}
      }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>

<style>
.smart-faq-section { background: #fff; }
.smart-faq-container { max-width: 800px; margin: 0 auto; padding: 0 20px; }
.smart-faq-title {
  text-align: center; font-size: 32px; color: #1a3a2a; margin-bottom: 24px;
}
.faq-search-wrap {
  position: relative; margin-bottom: 24px;
}
.faq-search-input {
  width: 100%; padding: 14px 16px 14px 44px;
  border: 2px solid #e0e8e0; border-radius: 10px;
  font-size: 16px; font-family: inherit;
  transition: border-color 0.2s;
}
.faq-search-input:focus { outline: none; border-color: #2d6a4f; }
.faq-search-icon {
  position: absolute; left: 14px; top: 50%;
  transform: translateY(-50%); pointer-events: none;
}
.faq-no-results {
  text-align: center; padding: 20px; color: #666; font-size: 15px;
}
.faq-no-results a { color: #2d6a4f; font-weight: 600; }
.faq-item {
  border-bottom: 1px solid #eee;
  transition: opacity 0.2s;
}
.faq-item.hidden { display: none; }
.faq-question {
  display: flex; align-items: center; justify-content: space-between;
  width: 100%; padding: 18px 0; background: none; border: none;
  cursor: pointer; font-size: 16px; font-weight: 600;
  color: #1a3a2a; text-align: left; font-family: inherit;
  gap: 12px;
}
.faq-question:hover { color: #2d6a4f; }
.faq-chevron {
  transition: transform 0.2s; flex-shrink: 0;
}
.faq-question[aria-expanded="true"] .faq-chevron {
  transform: rotate(180deg);
}
.faq-answer {
  max-height: 0; overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s ease;
  padding: 0 0;
  font-size: 15px; color: #555; line-height: 1.6;
}
.faq-item.open .faq-answer {
  max-height: 500px; padding: 0 0 18px;
}
</style>

<script>
(function() {
  // Toggle FAQ items
  document.querySelectorAll('.faq-question').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var item = btn.closest('.faq-item');
      var isOpen = item.classList.contains('open');

      // Close all others
      document.querySelectorAll('.faq-item.open').forEach(function(other) {
        other.classList.remove('open');
        other.querySelector('.faq-question').setAttribute('aria-expanded', 'false');
      });

      if (!isOpen) {
        item.classList.add('open');
        btn.setAttribute('aria-expanded', 'true');
      }
    });
  });

  // Search
  var searchInput = document.getElementById('faqSearch');
  var items = document.querySelectorAll('.faq-item');
  var noResults = document.getElementById('faqNoResults');

  searchInput.addEventListener('input', function() {
    var query = this.value.toLowerCase().trim();
    var visibleCount = 0;

    items.forEach(function(item) {
      if (!query) {
        item.classList.remove('hidden');
        visibleCount++;
        return;
      }
      var q = item.getAttribute('data-question');
      var a = item.getAttribute('data-answer');
      if (q.indexOf(query) !== -1 || a.indexOf(query) !== -1) {
        item.classList.remove('hidden');
        visibleCount++;
      } else {
        item.classList.add('hidden');
      }
    });

    noResults.style.display = (query && visibleCount === 0) ? 'block' : 'none';
  });
})();
</script>

{% schema %}
{
  "name": "Smart FAQ",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0, "max": 100, "step": 4, "unit": "px",
      "label": "Top padding", "default": 52
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0, "max": 100, "step": 4, "unit": "px",
      "label": "Bottom padding", "default": 52
    }
  ],
  "blocks": [
    {
      "type": "faq",
      "name": "FAQ Item",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Smart FAQ",
      "blocks": [
        {
          "type": "faq",
          "settings": {
            "question": "How much does cleaning cost?",
            "answer": "<p>Our cleaning starts at $100 for smaller homes and varies based on size, number of bedrooms/bathrooms, and frequency. Use our instant quote calculator for a personalized estimate, or request a free quote and we'll get back to you within 24 hours.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "What areas do you serve?",
            "answer": "<p>We serve Charlottesville, Albemarle County, Crozet, Keswick, Earlysville, Free Union, Waynesboro, Staunton, Lake Monticello, Gordonsville, Orange, and Fluvanna County. Contact us to confirm availability in your area.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "Do you offer eco-friendly cleaning products?",
            "answer": "<p>Yes! We offer eco-friendly, non-toxic cleaning products that are safe for children, pets, and your family. Just let us know your preference when you book.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "Do I need to sign a contract?",
            "answer": "<p>No contracts required. You can cancel or pause your service anytime with just 24-hour notice. We earn your business every visit.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "Are you insured?",
            "answer": "<p>Yes â€” we are fully insured and bonded. Your property is protected on every single visit. Peace of mind comes standard with every service.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "Do you offer both cleaning and landscaping?",
            "answer": "<p>Yes! We're one of the few companies in Charlottesville that handles both indoor cleaning and outdoor landscaping. Bundle both services and save 10%.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "How do I get a quote?",
            "answer": "<p>Three easy ways: 1) Use our instant quote calculator right here on the website, 2) Fill out our free estimate form, or 3) Call us at 434-351-0335. Most quotes are returned within 24 hours.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "What's your satisfaction guarantee?",
            "answer": "<p>100% satisfaction guaranteed. If any part of our work doesn't meet your expectations, call us within 24 hours and we'll come back to make it right at no additional charge.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
